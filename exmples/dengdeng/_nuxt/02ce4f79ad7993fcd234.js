(window.webpackJsonp=window.webpackJsonp||[]).push([[18,17],{348:function(e,t,r){var content=r(411);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(17).default)("e4a4ec72",content,!0,{sourceMap:!1})},362:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));r(10),r(32);var n=r(409),o=r.n(n),c=null;function d(e){var t,r,data,n;return regeneratorRuntime.async((function(d){for(;;)switch(d.prev=d.next){case 0:return t=e.$axios,d.next=3,regeneratorRuntime.awrap(t.post("public/oss/token",{}));case 3:r=d.sent,data=r.data.data,n=Object.assign({endpoint:data.endpoint,accessKeyId:data.accessKeyId,accessKeySecret:data.accessKeySecret,stsToken:data.securityToken,bucket:data.bucketName,cname:!0}),c=new o.a(n);case 7:case"end":return d.stop()}}))}function l(e){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=new FileReader;n.readAsArrayBuffer(e),n.onload=function(e){t(e.target.result)},n.onerror=function(e){r(e)}})));case 1:case"end":return t.stop()}}))}function f(e){return new o.a.Buffer(e)}function m(e,t,r){var n,o,m;return regeneratorRuntime.async((function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,regeneratorRuntime.awrap(l(r));case 2:if(n=v.sent,o=f(n),c){v.next=7;break}return v.next=7,regeneratorRuntime.awrap(d(e));case 7:return v.next=9,regeneratorRuntime.awrap(c.put(t,o));case 9:return m=v.sent,v.abrupt("return",m);case 11:case"end":return v.stop()}}))}},410:function(e,t,r){"use strict";var n=r(348);r.n(n).a},411:function(e,t,r){(e.exports=r(16)(!1)).push([e.i,".ruleForm[data-v-d15c67ec]{max-width:500px;padding:20px 0}.avatar-uploader[data-v-d15c67ec] .el-upload{border:1px dashed #d9d9d9;border-radius:50%;cursor:pointer;position:relative;overflow:hidden}.avatar-uploader[data-v-d15c67ec] .el-upload:hover{border-color:#409eff}.avatar-uploader[data-v-d15c67ec] .avatar-uploader-icon{font-size:28px;color:#8c939d;width:128px;height:128px;line-height:128px;text-align:center}.avatar-uploader[data-v-d15c67ec] .avatar{width:128px;height:128px;display:block}",""])},412:function(e,t,r){var content=r(646);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(17).default)("39a0901c",content,!0,{sourceMap:!1})},478:function(e,t,r){"use strict";r.r(t);r(127),r(32);var n=r(362),o={data:function(){var e=this.$axios.defaults;return{formData:{avatar:""},uploadUrl:"".concat(e.baseURL,"/customers/images"),uploadHeaders:{Authorization:this.$store.state.authorization,AuthorizationType:e.headers.AuthorizationType},uploadData:{questionId:1}}},created:function(){this.formData=Object.assign({},this.$store.state.userinfo)},methods:{handleAvatarError:function(e){this.$message.error(e.message||e)},beforeAvatarUpload:function(e){var t=/^image/.test(e.type);if(!t)return this.$message.error("请上传图片!");var r=e.size/1024/1024<2;return r?(this.upload(e),!1):this.$message.error("上传头像图片大小不能超过 2MB!")},upload:function(e){var t,r;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return t="avatar/".concat(this.$store.state.userinfo.id,".").concat(e.type.split("/")[1]),o.next=3,regeneratorRuntime.awrap(Object(n.a)(this,t,e));case 3:r=o.sent,this.formData.avatar="".concat(r.url,"?").concat((new Date).getTime()),this.$store.commit("set",{userinfo:this.formData}),this.saveAvatar(r.url);case 7:case"end":return o.stop()}}),null,this)},saveAvatar:function(e){var t;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(this.$axios.post("customers/userinfo/change",{avatar:e}));case 2:t=r.sent,t.data;case 4:case"end":return r.stop()}}),null,this)}}},c=(r(410),r(18)),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{staticClass:"ruleForm",attrs:{"label-width":"120px","label-position":"right"}},[r("el-form-item",{attrs:{label:"",prop:"avatar"}},[r("el-upload",{staticClass:"avatar-uploader",attrs:{"show-file-list":!1,headers:e.uploadHeaders,action:e.uploadUrl,data:e.uploadData,"on-error":e.handleAvatarError,"before-upload":e.beforeAvatarUpload}},[e.formData.avatar?r("img",{staticClass:"avatar",attrs:{src:e.formData.avatar}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),r("p",{staticStyle:{"padding-left":"20px"}},[e._v("点击上传头像")])],1)],1)}),[],!1,null,"d15c67ec",null);t.default=component.exports},645:function(e,t,r){"use strict";var n=r(412);r.n(n).a},646:function(e,t,r){(e.exports=r(16)(!1)).push([e.i,".box[data-v-61611266]{background:#fff;margin:10px;border-radius:5px;overflow:hidden}.box .header[data-v-61611266]{background:rgba(121,203,198,.3);padding:16px 20px;color:#478884}.ruleForm[data-v-61611266]{max-width:500px;padding:20px 0}@media (max-width:768px){.ruleForm[data-v-61611266]{padding-right:30px}}",""])},685:function(e,t,r){"use strict";r.r(t);r(32);var n={components:{avatar:r(478).default},data:function(){var e=this;return{formData:{nickname:"",passwdOld:"",passwd:"",passwd2:""},rules:{passwdOld:[{required:!0,message:"请输入旧密码",trigger:"change"}],passwd:[{required:!0,message:"请输入新密码",trigger:"change"},{min:6,message:"密码至少大于6位",trigger:"change"},{validator:function(t,r,n){""===r?n(new Error("请输入密码")):(""!==e.formData.passwd2&&e.$refs.formData.validateField("checkPass"),n())},trigger:"change"}],passwd2:[{required:!0,message:"请输入新密码",trigger:"change"},{min:6,message:"密码至少大于6位",trigger:"change"},{validator:function(t,r,n){""===r?n(new Error("请再次输入密码")):r!==e.formData.passwd?n(new Error("两次输入密码不一致!")):n()},trigger:"change"}]}}},created:function(){this.formData=Object.assign({},this.$store.state.userinfo)},methods:{submitForm:function(e){var t=this;this.$refs[e].validate((function(e){e&&t.save()}))},resetForm:function(e){this.$refs[e].resetFields()},save:function(){var e,data;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this.$axios.post("public/pwd/chg",{passwd:this.formData.passwd,oldPasswd:this.formData.passwdOld}));case 2:if(e=t.sent,(data=e.data)&&-1!==data.errorCode){t.next=8;break}return t.abrupt("return",this.$message.error(data.errorMsg));case 8:this.$message.success("密码已修改");case 9:case"end":return t.stop()}}),null,this)},logout:function(){this.$store.commit("set",{userinfo:{},authorization:""}),this.$router.push("/login")}}},o=(r(645),r(18)),component=Object(o.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"box"},[r("div",{staticClass:"header"},[e._v("\n      修改用户资料\n    ")]),e._v(" "),r("avatar")],1),e._v(" "),r("div",{staticClass:"box"},[r("div",{staticClass:"header"},[e._v("\n      修改密码\n    ")]),e._v(" "),r("el-form",{ref:"formData",staticClass:"ruleForm",attrs:{model:e.formData,rules:e.rules,"label-width":"120px","label-position":"right"}},[r("el-form-item",{attrs:{label:"旧密码",prop:"passwdOld"}},[r("el-input",{attrs:{type:"password"},model:{value:e.formData.passwdOld,callback:function(t){e.$set(e.formData,"passwdOld",t)},expression:"formData.passwdOld"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"新密码",prop:"passwd"}},[r("el-input",{attrs:{type:"password"},model:{value:e.formData.passwd,callback:function(t){e.$set(e.formData,"passwd",t)},expression:"formData.passwd"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"确认密码",prop:"passwd2"}},[r("el-input",{attrs:{type:"password"},model:{value:e.formData.passwd2,callback:function(t){e.$set(e.formData,"passwd2",t)},expression:"formData.passwd2"}})],1),e._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){return e.submitForm("formData")}}},[e._v("保 存")])],1)],1)],1),e._v(" "),r("div",{staticClass:"box"},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"danger"},on:{click:e.logout}},[e._v("退出登录")])],1)])}),[],!1,null,"61611266",null);t.default=component.exports}}]);