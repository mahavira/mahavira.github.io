(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9126"],{"35e1":function(t,e,n){"use strict";var i=n("cadd"),o=n.n(i);o.a},4825:function(t,e,n){"use strict";var i=n("8a8d"),o=n.n(i);o.a},5272:function(t,e,n){"use strict";var i=n("7879"),o=n.n(i);o.a},"646e":function(t,e,n){"use strict";var i=n("72a8"),o=n.n(i);o.a},"72a8":function(t,e,n){},7879:function(t,e,n){},"7f2e":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("transition",{attrs:{name:"van-fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"van-modal",on:{click:t.onCancel,touchmove:function(t){t.stopPropagation(),t.preventDefault()}}})]),n("div",{staticClass:"van-dialog",class:{closed:!t.visible},style:{top:t.top}},[t.showTitle?n("div",{class:["van-dialog__header","van-dialog__header--"+t.inputAlign]},[t._v(t._s(t.title))]):t._e(),n("div",{staticClass:"van-dialog__content"},[n("van-field",{ref:"input",attrs:{placeholder:t.placeholder,"input-align":t.inputAlign},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.onConfirm(e):null}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),n("div",{staticClass:"van-hairline--top van-dialog__footer van-dialog__footer--buttons"},[n("button",{staticClass:"van-button van-button--default van-button--large van-dialog__cancel",on:{click:t.onCancel}},[n("span",{staticClass:"van-button__text"},[t._v(t._s(t.cancelButtonText))])]),n("button",{staticClass:"van-button van-button--default van-button--large van-dialog__confirm",attrs:{type:"submit"},on:{click:t.onConfirm}},[n("span",{staticClass:"van-button__text"},[t._v(t._s(t.confirmButtonText))])])])])],1)},o=[],s=(n("cadf"),n("551c"),n("097d"),"-100px"),a={props:{visible:{type:Boolean,default:!1},text:{type:String,default:""},placeholder:{type:String,default:"请输入评论内容"},confirmButtonText:{type:String,default:"确认"},cancelButtonText:{type:String,default:"取消"},showTitle:{type:Boolean,default:!1},title:{type:String,default:"提示"},inputAlign:{type:String,default:"center"}},data:function(){return{content:this.text,top:s}},watch:{text:function(){this.content!==this.text&&(this.content=this.text)}},methods:{focus:function(){var t=this;window.document.querySelector("body").style.overflow="hidden",this.$refs.input.$el.querySelector("input").focus(),this.$nextTick(function(){t.top="35%"})},onConfirm:function(){this.content&&(this.$emit("onConfirm",this.content),this.onCancel())},onCancel:function(){this.$emit("update:visible",!1),window.document.querySelector("body").style.overflow="auto",this.top=s,this.$refs.input.$el.querySelector("input").blur()}}},c=a,m=(n("646e"),n("2877")),r=Object(m["a"])(c,i,o,!1,null,"21688f88",null);r.options.__file="PopupInput.vue";e["a"]=r.exports},"8a8d":function(t,e,n){},"978d":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"moment"},[n("div",{staticClass:"moment-list"},[n("moment-item",{attrs:{item:t.moment,hasLike:t.checkHasLike},on:{onComment:t.onComment,addLike:t.addLike,onRemove:t.onRemoveMoment}})],1),t.likes.length||t.comments.length?n("div",{staticClass:"comments"},[t.likes.length?n("div",{staticClass:"comments-row van-row--flex"},[t._m(0),n("div",{staticClass:"van-row content"},t._l(t.likes,function(e,i){return n("div",{key:i,staticClass:"like"},[n("img",{attrs:{src:e.headUrl},on:{click:function(n){t.redirectMoments(e.userId)}}})])}))]):t._e(),t.comments.length?n("div",{staticClass:"comments-row van-hairline--top"},[n("div",{staticClass:"van-row--flex"},[t._m(1),n("div",{staticClass:"content"},t._l(t.comments,function(e){return n("comment-item",t._b({key:e.id,on:{removeComment:t.removeComment}},"comment-item",e,!1))}))])]):t._e()]):t._e(),n("popup-input",{ref:"popupInput",attrs:{visible:t.visibleCommentModal,placeholder:"请输入评论内容",confirmButtonText:"发送"},on:{"update:visible":function(e){t.visibleCommentModal=e},onConfirm:t.onCommentConfirm}})],1)},o=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"title"},[n("i",{staticClass:"icon icon-like"})])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"title"},[n("i",{staticClass:"icon icon-comment"})])}],s=(n("f751"),n("cadf"),n("551c"),n("097d"),n("7f2e")),a=n("e653"),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"van-row--flex comment"},[n("div",{staticClass:"headimg",on:{click:function(e){t.redirectMoments(t.userId,t.nickName)}}},[n("img",{attrs:{src:t.headUrl,alt:""}})]),n("div",{staticClass:"content"},[n("div",{staticClass:"ht"},[t._v(t._s(t.nickName))]),n("div",{staticClass:"txt"},[t._v(t._s(t.comment))]),n("div",{staticClass:"date"},[t.userId==t.$store.state.userinfo.userId?n("a",{staticClass:"delete",attrs:{href:"javascript:;"},on:{click:function(e){t.$emit("removeComment",t.msgId)}}},[t._v("删除")]):t._e(),t._v("\n        "+t._s(t._f("moment")(t.msgTime,"YYYY年MM月DD日 HH:mm"))+"\n      ")])])])},m=[],r=(n("c5f6"),{props:{userId:String,msgId:String,parentId:String,nickName:String,comment:String,headUrl:String,msgTime:Number},data:function(){return{}},created:function(){},methods:{redirectMoments:function(t,e){console.log(t,e),this.$bridge.callhandler("openFriendPage",{userId:t},function(){})}}}),l=r,u=(n("5272"),n("2877")),d=Object(u["a"])(l,c,m,!1,null,"c9aef1d2",null);d.options.__file="CommentItem.vue";var f=d.exports,h={components:{PopupInput:s["a"],MomentItem:a["a"],CommentItem:f},data:function(){return{momentId:0,moment:{},likes:[],comments:[],visibleCommentModal:!1}},computed:{checkHasLike:function(){var t=this;return!!this.likes.length&&this.likes.some(function(e){return e.userId===t.$store.state.userinfo.userId})}},created:function(){this.momentId=this.$route.params.momentId,this.momentId?(this.fetchMoment(),this.fetchComments(),this.fetchLikes()):this.$toast.fail("没有获取到新鲜事ID!")},methods:{fetchMoment:function(){var t=this;this.$api.getMoment({momentId:this.momentId}).then(function(e){var n=e.data;t.moment=Object.assign(n.obj,{visible:!0})}).catch(function(){t.$toast.fail("数据请求失败!")})},fetchComments:function(){var t=this;this.$api.getMomentComments({momentId:this.momentId}).then(function(e){var n=e.data;t.comments=n.objs,t.moment.msgNum=t.comments.length}).catch(function(){t.$toast.fail("数据请求失败!")})},fetchLikes:function(){var t=this;this.$api.getMomentLikes({momentId:this.momentId}).then(function(e){var n=e.data,i=[];t.likes=n.objs.filter(function(t){return!(i.indexOf(t.userId)>=0)&&(i.push(t.userId),!0)}),t.moment.thumbUpNum=t.likes.length}).catch(function(){t.$toast.fail("数据请求失败!")})},addLike:function(){var t=this;this.$route.params.momentId&&(this.checkHasLike?(this.likes=this.likes.filter(function(e){return e.userId!==t.$store.state.userinfo.userId}),this.$api.deleteMomentLike({momentId:this.$route.params.momentId}).then(function(){t.fetchLikes()}).catch(function(){t.$toast.fail("数据请求失败!")})):(this.likes.push({userId:this.$store.state.userinfo.userId}),this.$api.addMomentLike({momentId:this.$route.params.momentId}).then(function(){t.fetchLikes()}).catch(function(){t.$toast.fail("数据请求失败!")})))},addComment:function(t){var e=this;this.$route.params.momentId&&this.$api.addMomentComment({momentId:this.$route.params.momentId,msg:t,parentId:0}).then(function(){e.fetchComments()}).catch(function(){e.$toast.fail("数据请求失败!")})},removeComment:function(t){var e=this;this.$route.params.momentId&&this.$api.deleteMomentComment({commentId:t}).then(function(){e.fetchComments()}).catch(function(){e.$toast.fail("数据请求失败!")})},onRemoveMoment:function(){this.moment.visible=!1,this.$bridge.callhandler("backPage",{isRefresh:!0},function(){})},onComment:function(){this.checkLogin()&&this.$route.params.momentId&&(this.visibleCommentModal=!0,this.$refs.popupInput.focus())},onCommentConfirm:function(t){this.addComment(t),this.$refs.popupInput.content=""},redirectMoments:function(t){this.$bridge.callhandler("openFriendPage",{userId:t},function(){})}}},v=h,p=(n("35e1"),Object(u["a"])(v,i,o,!1,null,"4de865c8",null));p.options.__file="Moment.vue";e["default"]=p.exports},cadd:function(t,e,n){},e653:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return!1!==t.item.visible?n("div",{staticClass:"moment-item"},[n("div",{staticClass:"media van-hairline--bottom"},[n("div",{staticClass:"headimg",on:{click:function(e){t.redirectMoments(t.item.userId,t.item.nickName)}}},[n("img",{staticClass:"van-hairline--surround",attrs:{src:t.item.headURL,alt:""}})]),n("div",{staticClass:"content",on:{click:function(e){t.handleToMoment(t.item.id)}}},[n("div",{staticClass:"nickname"},[t._v(t._s(t.item.nickName))]),n("div",{staticClass:"content"},[t._v(t._s(t.item.momentContent))]),n("div",{staticClass:"pictures van-row"},t._l(t.item.imageListS,function(e,i){return n("div",{key:i,staticClass:"picture-item",style:{backgroundImage:"url("+e+")"},on:{click:function(e){e.stopPropagation(),t.previewPicture(i,t.item.imageListB)}}})})),n("aside",{staticClass:"aside"},[n("span",[t._v(t._s(t._f("moment")(t.item.momentTime,"YYYY/MM/DD HH:mm"))+"\n          "),t.item.userId==t.$store.state.userinfo.userId?n("a",{on:{click:function(e){e.stopPropagation(),t.onRemoveMoment(t.item)}}},[t._v("删除")]):t._e(),t.item.userId!=t.$store.state.userinfo.userId?n("a",{on:{click:function(e){e.stopPropagation(),t.onReportMoment(t.item)}}},[t._v("举报")]):t._e()]),n("span",{staticClass:"handler"},[n("span",{on:{click:function(e){t.handleLike()}}},[n("i",{staticClass:"icon icon-like",class:{active:t.hasLike}}),t._v("\n            "+t._s(t.item.thumbUpNum||0)+"\n          ")]),n("span",{on:{click:function(e){t.$emit("onComment")}}},[n("i",{staticClass:"icon icon-comment"}),t._v(" "+t._s(t.item.msgNum||0)+"\n          ")])])])])])]):t._e()},o=[],s={props:{item:Object,hasLike:Boolean},methods:{handleLike:function(){this.checkLogin()&&this.$route.params.momentId&&this.$emit("addLike")},previewPicture:function(t,e){this.$bridge.callhandler("previewImage",{index:t,urls:e},function(){})},handleToMoment:function(t){this.$route.params.momentId||this.$router.push("/moment/".concat(t))},redirectMoments:function(t,e){console.log(e),this.$bridge.callhandler("openFriendPage",{userId:t},function(){})},onRemoveMoment:function(t){var e=this;this.$dialog.confirm({title:"确认删除？",beforeClose:function(n,i){"confirm"===n?(e.$emit("onRemove",t.id),e.$api.deleteMoment({momentId:t.id}).then(function(){e.$toast("已删除!")}).catch(function(){return e.$toast.fail("删除失败!")}),i()):i()}})},onReportMoment:function(){this.checkLogin()&&this.$toast("已举报!")}}},a=s,c=(n("4825"),n("2877")),m=Object(c["a"])(a,i,o,!1,null,"4a66c61e",null);m.options.__file="MomentItem.vue";e["a"]=m.exports}}]);